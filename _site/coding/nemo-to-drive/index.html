<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEMO to Drive | Denton Works</title>
    <meta name="description" content="My journey through wrenching, coding, and microelectronics projects! This is where I document my adventures and share my work with the lofty goal of making the world a better place.">
    <meta name="tags" content="automation, file-transfer, google-drive, nemo, python, api, sync, backup, lab-management, null">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-D4VMNE2JPX"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-D4VMNE2JPX');
    </script>
    <link rel="stylesheet" href="/styles/main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Mermaid CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mermaid@11.12.0/dist/mermaid.min.css">
    <!-- Model Viewer -->
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.4.0/model-viewer.min.js"></script>
</head>
<body>
    <header class="header">
        <nav class="nav">
            <div class="nav__container">
                <a href="/" class="nav__brand">
                    Denton Works
                </a>
                <button class="nav__toggle" aria-label="Toggle navigation menu">
                    <span class="nav__toggle-line"></span>
                    <span class="nav__toggle-line"></span>
                    <span class="nav__toggle-line"></span>
                </button>
                <ul class="nav__menu">
                    <li><a href="/" class="nav__link">Home</a></li>
                    <li class="nav__dropdown">
                        <a href="/coding/" class="nav__link">Coding</a>
                        <ul class="nav__submenu">
                            <li><a href="/coding/nemo-merger/">NEMO Merger</a></li>
                            <li><a href="/coding/nemo-to-drive/">NEMO to Drive</a></li>
                            <li><a href="/coding/NEMO-MQTT-Plugin/">NEMO MQTT Plugin</a></li>
                            <li><a href="/coding/denton-works/">Denton Works Website</a></li>
                        </ul>
                    </li>
                    <li class="nav__dropdown">
                        <a href="/wrenching/" class="nav__link">Wrenching</a>
                        <ul class="nav__submenu">
                            <li><a href="/wrenching/thunderbird-restoration/">1968 Thunderbird</a></li>
                            <li><a href="/wrenching/3d-models/">3D Models</a></li>
                            <li><a href="/wrenching/general-mechanical/">General Mechanical</a></li>
                        </ul>
                    </li>
                    <li class="nav__dropdown">
                        <a href="/microelectronics/" class="nav__link">Microelectronics</a>
                        <ul class="nav__submenu">
                            <li><a href="/microelectronics/Smart-T-Bird/">Smart Thunderbird</a></li>
                            <li><a href="/microelectronics/NEMO-Tool-Display-Hardware/">NEMO Tool Display</a></li>
                        </ul>
                    </li>
                    <li class="nav__dropdown">
                        <a href="/general/" class="nav__link">General</a>
                        <ul class="nav__submenu">
                            <li><a href="/general/Today-I-Learned/">Today I Learned</a></li>
                            <li><a href="/general/everything-else/">Everything Else</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </nav>
    </header>

    <main class="main">
        <article class="container">
    <header class="page-header">
        <h1>NEMO to Drive</h1>
        
    </header>
    
    <div class="page-content">
        <h2>Project Overview</h2>
<ul>
<li>Script to automatically transfer files from NEMO to Google Drive. It started with just billing data to be ingested into Tableu, but I am also adding post usage questions data. Currently, staff memebrs don't have an easy way to see the post usage questions data. <a href="https://github.com/SNF-Root/NEMO-VM"><strong>GitHub Repo</strong></a></li>
</ul>
<h2>Process Flow</h2>
<div class="mermaid" id="mermaid-xynawslg5">
graph LR
    A["Runs main function<br><small><i>(Every Hour)</i></small>"]
  A --> B["Fetches current month's data<br><small><i>(from 1st of month to now)</i></small>"]
  B --> C["Uploads monthly CSV on Google Drive Sub folder<br><small><i>(Overwrites existing file)</i></small>"]
  C --> D["Update a yearly master CSV on Google Drive<br><small><i>(Deletes and re-uploads the last 40 days)</i></small>"]
  D --> E["Updates all time master CSV at root directory<br><small><i>(Deletes and re-uploads the last 40 days)</i></small>"]
  C --> F["Creates New Month file on 1st of the month"]
  E --> G["Cleans up local files<br><small><i>(Deletes old files)</i></small>"]
</div>
<h2>Up Next</h2>
<ul>
<li>Setting up Google VM for all the scripts</li>
</ul>
<h2>Work Log</h2>
<h3>11/13/2025</h3>
<p><strong>Main Task:</strong> Data not matching</p>
<p><strong>Notes:</strong></p>
<ul>
<li>there are discrepancies in the length between the monthly, annual, and master csvs.</li>
<li>Update, the nummber of billing data will not be the same as usage events, becasue consumables also count as billing data.</li>
<li>The yearly download was broken and was only downloading the last 40 days.</li>
<li>There was a large discrepancy in the files, looks like the overwriting the last 40 days wasn't enough.</li>
<li>Also it seems like sometime multiple events with the same item_id were downloaded, which is really strange to me because this should be a unique value in nemo. I think it has to do with my overwrite script or something
<ul>
<li>Now if it sees items with the same item_id, it will delete the old one and keep the new one.</li>
</ul>
</li>
<li>Update, I was right, nemo can't have duplicate item_ids, I was the one introducing them by accident.</li>
<li>Made the download so it does no clean up, just straight download, and it does the whole year everytime.</li>
</ul>
<h3>11/2/2025</h3>
<p><strong>Main Task:</strong> Master CSV bug fix and annual report creation</p>
<p><strong>Notes:</strong></p>
<ul>
<li>There was a bug in the master csv. because I was only appending new entries, the old ones were never being corrected like if there was an erroniously long usage event</li>
<li>I made it so the last 40 days are deleted and re-downloaded everytime the script runs</li>
<li>Also made a master csv with all years data in the root directory</li>
<li>Now on NEMO there is an easy way to see the post usage questions, so I'm removing that from this program. Feels bad to waste time but you get that.</li>
</ul>
<h3>10/13/2025</h3>
<p><strong>Main Task:</strong> Scheduling and automation fixes, post usage questions update</p>
<p><strong>Notes:</strong></p>
<ul>
<li>Had the script set up to run every hour on the bottom of the hour on my local machine but I didn't test it at all so it wasn't actually running</li>
<li>Made somechanges and now it should actually run, classic token/env stuff not set up right.</li>
<li>Also updated the post usage question script so that it was actually automated. It last ran in august.</li>
<li>Changed the usage questions to pull only the latest month just like the billing data.</li>
</ul>
<h3>10/10/2025</h3>
<p><strong>Main Task:</strong> Monthly report bug fix and annual report generation</p>
<p><strong>Notes:</strong></p>
<ul>
<li>Turns our Eli has made progress on the Tableu side, so I need to make sure the data is there for him</li>
<li>My Daemon on the collector has been working this whole time which is pretty cool I hadn't checked on it in forever.</li>
<li>Slight bug where it made a new monthly report for the first two days of the month and then made a seperate report correctly with the entire month</li>
<li>Worked fixing that bug, and generating an annual report with ALL the years data</li>
<li>Can't NoMachine into the collector for some reason, so I set up the script to run locally every half hour on my local machine for now, just kinda for funsises.</li>
</ul>
<h3>08/07/2025</h3>
<p><strong>Main Task:</strong> Post usage questions data processing</p>
<p><strong>Notes:</strong></p>
<ul>
<li>The billing seems to be working nicely which is cool</li>
<li>Started working on getting the post usage question data out and onto the drive, that seems to be working well. Just a lot of data processing steps</li>
<li>Need to move it to the collector and then it'll be sorted</li>
<li>My tool/user list is static as well so if i wanted it to be really robust I'd also have it update the tool and user lists</li>
</ul>
<h3>08/6/2025</h3>
<p><strong>Main Task:</strong> Migration to Google Drive service account</p>
<p><strong>Notes:</strong></p>
<ul>
<li>Haha you thought! Changed everything over to run on the shared drive using a service account. You must use a shared Google drive if you are going to use a Service account bot buddy</li>
<li>I clobbered the old instance on the collector and pulled a new version down once I figured out the whole new authentication scheme</li>
<li>Also cleaned up the repo, It's be cool to share it some time</li>
</ul>
<h3>08/5/2025</h3>
<p><strong>Main Task:</strong> Cron job configuration fixes</p>
<p><strong>Notes:</strong></p>
<ul>
<li>never really done am I? The .env was not being correctly loaded in the cron job because there were spaces between the variable names and the actual key, so it wasn't working</li>
<li>My scheduling was also whack and it was running at 8 minutes and 20 minutes past the hour, which I never remember setting. maybe I though 8am and 20:00=8pm? Anyways I changed it to run every hour cause why not</li>
<li>I'm wondering if I should put a bit more work into this to make it something other people can implement in other labs. That said, the whole google auth thing is a bit of a pain so it isn't for the faint of heart</li>
</ul>
<h3>08/04/2025</h3>
<p><strong>Main Task:</strong> Master upload script improvements</p>
<p><strong>Notes:</strong></p>
<ul>
<li>made modifiactions to the bash script that does the master upload, seems to be working</li>
<li>had to add steps to it compies the files to the nemo_automation folder, it also creates a venv automatically now, in later versions of the set up script</li>
<li>I guess this project is done for now, until it breaks or we need new functionality</li>
</ul>
<h3>07/28/2025</h3>
<p><strong>Main Task:</strong> VM deployment and authentication</p>
<p><strong>Notes:</strong></p>
<ul>
<li>Modified the existing script so that it can be run on a VM (or on the collector)</li>
<li>I deleted the token and reauthenticated, and now things work OK.</li>
</ul>

    </div>
</article>

    </main>

    <footer class="footer">
        <div class="footer__container">
            <p>&copy; 2025 Alex - Denton Works</p>
            <div class="footer__social">
                <a href="https://github.com/alexanderenrique" target="_blank" rel="noopener">GitHub</a>
                <a href="https://twitter.com/yourusername" target="_blank" rel="noopener">Twitter</a>
            </div>
        </div>
    </footer>

    <script src="/js/main.js"></script>
    <!-- Mermaid JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@11.12.0/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#3b82f6',
                primaryTextColor: '#1f2937',
                primaryBorderColor: '#1e40af',
                lineColor: '#6b7280',
                secondaryColor: '#f3f4f6',
                tertiaryColor: '#ffffff'
            }
        });
    </script>
</body>
</html>
